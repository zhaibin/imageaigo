# 更新日志

## [v1.2.1] - 2024-10-15

### 🔧 优化

#### 1. JSON 数据精简
- JSON 数据仅返回 `description` 和 `tags` 字段
- API `/api/image-json/{slug}` 返回精简数据
- 减少数据传输量，提升响应速度

#### 2. JSON 模块折叠
- JSON Data 模块默认折叠状态
- 点击标题可展开/折叠
- 图标指示当前状态（▶/▼）
- 改善页面简洁度

#### 3. AI 分析优化
- 图片描述长度：100 字符 → 50 字符
- 更简洁的描述提示词
- max_tokens：100 → 50

#### 4. 压缩优化
- 压缩图片长边：500px → 256px
- 减少 AI 处理时间
- 降低传输带宽

### 📝 文件修改
- `src/index.js` - 新增 `handleGetImageJson` 函数
- `src/analyzer.js` - 优化描述提示词和 token 数
- `src/html-builder.js` - JSON 折叠功能、压缩尺寸调整

---

## [v1.2.0] - 2024-10-15

### ✨ 新功能

#### 1. 防重复上传
- 上传图片时自动检测哈希值
- 如果图片已存在，返回重复提示并跳转到已有图片
- 避免浪费存储空间和 AI 算力

#### 2. 防滥用机制
- **速率限制**：每个 IP 每小时最多 10 次上传
- **机器人检测**：识别并记录可疑的 User-Agent
- **行为分析**：检测缺少 Referer 等异常行为
- **友好提示**：达到限制时显示剩余时间

#### 3. 域名更新
- 统一使用 imageaigo.cc 域名
- 更新所有相关链接和文档

### 🔒 安全增强
- IP 基础的速率限制（使用 KV 存储）
- 可疑行为日志记录
- 返回 429 状态码和 Retry-After 头

### 📝 文件修改
- `src/index.js` - 速率限制、重复检测、可疑行为检测
- `src/html-builder.js` - 前端处理重复图片跳转、速率限制提示
- `README.md` - 更新域名

---

## [v1.1.0] - 2024-10-15

### ✨ 新功能

#### 1. KV 缓存优化
- 图片列表 API 增加 KV 缓存（5分钟）
- 图片详情 API 增加 KV 缓存（10分钟）
- 大幅减少数据库查询，提升响应速度

#### 2. 批量上传功能
- 管理后台新增批量上传入口
- 支持一次上传最多 10 张图片
- 异步后台处理，避免请求超时
- 实时显示上传进度
- 自动去重，跳过已存在的图片

#### 3. 删除操作优化
- 删除图片时自动清理相关 KV 缓存
- 清理包括：图片哈希缓存、图片详情缓存、列表缓存
- 确保数据一致性

#### 4. 图片详情页增强
- 显示完整的 JSON 数据
- 提供 JSON API URL（`/api/image-json/{slug}`）
- 一键复制 JSON 数据
- 一键复制 API URL
- 方便开发者集成使用

### 🔧 重构
- Footer 统一化：创建独立模板，所有页面使用统一 footer
- 文档优化：精简文档，仅保留 README、CHANGELOG、LICENSE

### 📝 文件修改
- 新增：`src/footer-template.js`、`.cursorrules`
- 更新：`src/index.js`、`src/admin.js`、`src/html-builder.js`
- 删除：6 个冗余文档

---

## [v1.0.3] - 2024-10-15

### 重构
- Footer 统一化：创建独立模板，所有页面使用统一 footer
- 文档优化：精简文档，仅保留 README、CHANGELOG、LICENSE

---

## [v1.0.2] - 2024-10-15

### 新功能
- **首页标签可点击**：Level 1 标签跳转到 category 页面，其他跳转到 tag 页面
- **Category 页面点赞**：图片卡片可直接点赞/取消点赞

### 样式优化
- 标签悬停效果（缩放 + 阴影）
- 点赞按钮红色主题，流畅动画

---

## [v1.0.1] - 2024-10-15

### Bug 修复
- **图片尺寸存储问题**：修复存储压缩图尺寸的问题，现在正确存储原始图片尺寸
  - 导出 `getImageDimensions` 函数
  - 从原始图片获取尺寸
  - 用原始尺寸覆盖分析结果

---

## [v1.0.0] - 2024-10-15

### 核心功能

#### AI 图片分析
- 智能描述生成（Llama 3.2 11B Vision）
- 层级化标签系统（主分类、子分类、属性）
- 自动尺寸提取（JPEG/PNG/GIF/WebP）
- 基于哈希的去重

#### 用户界面
- 瀑布流响应式布局
- 全文搜索
- 分类/标签筛选
- 点赞功能

#### 管理后台
- Token 认证系统
- 数据统计面板
- 图片管理（查看、搜索、删除）
- 标签管理
- 系统清理（R2、KV、数据库）

#### 技术特性
- Cloudflare Workers Edge 计算
- D1 数据库
- R2 对象存储
- KV 缓存
- 多级缓存策略
- 防盗链保护
- SEO 优化

---

## 版本说明

- **v1.0.x**: 功能完善和优化阶段
- **v1.0.0**: 初始发布版本

详细更新内容请查看各版本说明。
